                    00001           STATUS EQU 3
                    00002           B_RP0 EQU 5
                    00003           B_CARRY EQU 0
                    00004           PORTB EQU 6
                    00005           TRISB EQU 6
                    00006           PORTA EQU 5
                    00007           TRISA EQU 5
                    00008           FZERO EQU 2
                    00009           
                    00010           RCOUNT EQU 0Ch
                    00011           RFLANKE EQU 010h
                    00012           
                    00013           
                    00014           device 16F84
                    00015  INIT     
0000 1683           00016           BSF STATUS, B_RP0 ; zu Bank 1 wechseln
0001 3004           00017           MOVLW 4h   ; Port a pin 3 ist output, rest ist input
0002 0085           00018           MOVWF TRISA   ; Tris a setzen
0003 3000           00019           MOVLW 00h   ; Port b ist komplett Output
0004 0086           00020           MOVWF TRISB   ; Tris b setzen
0005 1283           00021           BCF STATUS, B_RP0 ; zurück zu Bank 0
                    00022           
0006 0805           00023           MOVF PORTA, w  ; Read port a into w
0007 3010           00024           MOVLW RFLANKE  ; w nach 10h kopieren, damit im ersten durch
0008 3098           00025           MOVLW 010011000b
0009 008C           00026           MOVWF RCOUNT
                    00027           ;CLRF RCOUNT   ; erste erlaubte (und freie) speicherstelle 
000A 1185           00028           BCF PORTA, 3  ; carry auf null setzen
000B 0186           00029           CLRF PORTB   ; clear file register port b 
                    00030  READ      
000C 1885           00031           BTFSC PORTA, 1  ; check if reset bit is active (ODER: BTFSC
000D 282D           00032           GOTO RESET
000E 1905           00033           BTFSC PORTA, 2  ; skip next instruction if bit was not set;
000F 280C           00034           GOTO READ
0010 2024           00035           CALL FLANKE   ; UP flankenerkennung
0011 3901           00036           ANDLW 1    ; war das UP erfolgreich?
0012 1903           00037           BTFSC STATUS, FZERO ; ZF 0 bedeuet AND war 1 bedeutet UP wa
0013 280C           00038           GOTO READ
                    00039             
0014 080C           00040           MOVF RCOUNT, w  ; zähler nach w
0015 3A99           00041           XORLW 099h   ; höchmöglicher wert (99)
0016 1903           00042           BTFSC STATUS, FZERO ; falls z = 1
0017 282D           00043           GOTO RESET   ; zurücksetzen
                    00044             
0018 300F           00045           MOVLW 0Fh   ; wert für and
0019 050C           00046           ANDWF RCOUNT, w  ; RCOUNT & 00001111
001A 3C09           00047           SUBLW 09h   ; subtract 9 from w
001B 1903           00048           BTFSC STATUS, FZERO ; falls z = 1
001C 2031           00049           CALL BCD_ADD ; 6 addieren
                    00050             
001D 0A8C           00051           INCF RCOUNT   ; zähler erhöhen
001E 1005           00052           BCF PORTA, B_CARRY
001F 1903           00053           BTFSC STATUS, FZERO ; ZERO flag ist 1, falls es einen über
0020 1405           00054           BSF PORTA, B_CARRY ; carry setzen
0021 080C           00055           MOVF RCOUNT, w
0022 0086           00056           MOVWF PORTB   ; zähler in den ausgang schreiben
0023 280C           00057           GOTO READ
                    00058  FLANKE   
0024 0805           00059           MOVF PORTA, w  ; port a ins w register kopieren
0025 0610           00060           XORWF RFLANKE, w ; xor von w mit RFLANKE, das ergebnis steh
0026 3901           00061           ANDLW 1    ; nur bit 0 ist relevant, ergebnis 1 falls flank
0027 1903           00062           BTFSC STATUS, FZERO ; überspringen, wenn fzero 0 ist (flan
0028 3400           00063           RETLW 0
0029 0690           00064           XORWF RFLANKE, 1 ; alter wert wird auf neuen wert gesetzt
002A 1C10           00065           BTFSS RFLANKE, 0 ; es gab einen flankenwechsel, aber sind w
002B 3400           00066           RETLW 0   ; aktuell liegt keine 1 an
002C 3401           00067           RETLW 1    ; richtige flanke gefunden
                    00068  RESET    
002D 0186           00069           CLRF PORTB   ; ausgang clearen
002E 018C           00070           CLRF RCOUNT   ; zähler register clearen
002F 1005           00071           BCF PORTA, B_CARRY ; carry zurücksetzen
0030 280C           00072           GOTO READ   ; zurück zu read
                    00073  BCD_ADD  
0031 3006           00074           MOVLW 06h   ; 6 in w schreiben
0032 078C           00075           ADDWF RCOUNT, 1  ; 6 auf den zähler addieren, danach wird 
0033 3400           00076           RETLW 0    ; return, rückgabewert egal
                    00077           END
